# Route for API endpoints - MUST come before frontend catch-all
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: api-route
  namespace: bookstore
spec:
  entryPoints:
    - web
  routes:
  - match: PathPrefix(`/api`)
    kind: Rule
    middlewares:
    - name: api-stripprefix
      namespace: bookstore
    services:
    - name: api
      port: 80
---
# Route for user service - MUST come before frontend catch-all  
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: user-route
  namespace: bookstore
spec:
  entryPoints:
    - web
  routes:
  - match: PathPrefix(`/users`)
    kind: Rule
    middlewares:
    - name: user-stripprefix
      namespace: bookstore
    services:
    - name: user-service
      port: 80
---
# Route for the main website (frontend) - MUST be last (catch-all)
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: frontend-route
  namespace: bookstore
spec:
  entryPoints:
    - web
  routes:
  - match: PathPrefix(`/`)
    kind: Rule
    services:
    - name: frontend
      port: 80
    priority: 1  # Lower priority so other routes match first
---
# Route for Traefik dashboard
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: dashboard-route
  namespace: traefik-system
spec:
  entryPoints:
    - web
  routes:
  - match: PathPrefix(`/dashboard`)
    kind: Rule
    services:
    - name: traefik-dashboard
      port: 9000