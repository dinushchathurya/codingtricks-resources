# Middleware to remove /api prefix from requests
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: api-stripprefix
  namespace: bookstore
spec:
  stripPrefix:
    prefixes:
      - /api
---
# Middleware to remove /users prefix from requests  
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: user-stripprefix
  namespace: bookstore
spec:
  stripPrefix:
    prefixes:
      - /users
---
# Security headers middleware (good practice!)
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: security-headers
  namespace: bookstore
spec:
  headers:
    customResponseHeaders:
      X-Frame-Options: "DENY"
      X-Content-Type-Options: "nosniff"
      X-XSS-Protection: "1; mode=block"
---
# Rate limiting middleware to prevent abuse
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: rate-limit
  namespace: bookstore
spec:
  rateLimit:
    period: 1m
    average: 100  # 100 requests per minute
    burst: 200    # Allow bursts up to 200